<extension>
    <modules>
        <module>
            <id>Email Documents</id>
            <description>Apply to all document libraries</description>
            <customizations>
                <customization>
                    <targetPackageRoot>org.alfresco</targetPackageRoot>
                    <sourcePackageRoot></sourcePackageRoot>
                    <dependencies>
                        <js>components/documentlibrary/actions/email-documents.js</js>
                    </dependencies>
                </customization>
            </customizations>
                        
            <configurations>
                <config evaluator="string-compare" condition="emailDocumentsWithHistoryAction">
                    Â <forms>
                        <form>
                            <field-visibility>
                                <show id="to"/>
                                <show id="from" />
                                <show id="subject"/>
                                <show id="body"/>
                                <show id="convert"/>
                            </field-visibility>
                            <appearance>
                                <field id="to" label-id="email-documents.field.to"/>
                                <field id="from" label-id="email-documents.field.from"/>
                                <field id="subject" label-id="email-documents.field.subject"/>
                                <field id="body" label-id="email-documents.field.body">
                                    <control
                                        template="/org/alfresco/components/form/controls/textarea.ftl" />
                                </field>
                                <field id="convert" label-id="email-documents.field.body">
                                    <control
                                        template="/org/alfresco/components/form/controls/checkbox.ftl" />
                                </field>
                            </appearance>
                        </form>
                    </forms>
                </config>

                <!-- Custom DocLibActions config section -->
                <config evaluator="string-compare" condition="DocLibActions">
                    <actions>
                        <action id="email-documents" type="javascript" label="actions.email-documents" icon="cyberconnect">
                            <param name="function">onActionSendDocumentsViaEmail</param>
                            <param name="itemKind">action</param>
                            <param name="itemId">emailDocumentsWithHistoryAction</param>
                            <param name="destination">{node.nodeRef}</param>
                            <param name="mode">create</param>
                            <param name="successMessage">message.email-documents.success</param>
                            <param name="failureMessage">message.email-documents.failure</param>
                        </action>
                    </actions>
                    <actionGroups>
                        <actionGroup id="document-browse">
                            <action index="300" id="email-documents" />
                        </actionGroup>
                        <actionGroup id="document-details">
                            <action index="300" id="email-documents" />
                        </actionGroup>
                        <actionGroup id="folder-browse">
                            <action index="300" id="email-documents" />
                        </actionGroup>
                        <actionGroup id="folder-details">
                            <action index="300" id="email-documents" />
                        </actionGroup>
                    </actionGroups>
                </config> 
    
                <config evaluator="string-compare" condition="DocumentLibrary" replace="false">
                    <aspects>
                        <visible>
                            <aspect name="jb:emailTemplate" />
                        </visible>
                        <addable>
                            <aspect name="jb:emailTemplate" />
                        </addable>

                        <!-- Aspects that a user can remove. Same as "visible" if left empty -->
                        <removeable>
                        </removeable>
                    </aspects>                
                </config>
                
                <config evaluator="aspect" condition="jb:emailTemplate">
                    <forms>
                        <form>
                            <field-visibility>
                                <show id="jb:from" />
                                <show id="jb:to" />
                                <show id="jb:subject" />
                                <show id="jb:body" />
                            </field-visibility>
                            <appearance>
                                <field id="jb:from" label-id="jb_from"/>
                                <field id="jb:to" label-id="jb_to"/>
                                <field id="jb:subject" label-id="jb_subject"/>
                                <field id="jb:body" label-id="jb_body">
                                    <control template="/org/alfresco/components/form/controls/textarea.ftl" />
                                </field>
                            </appearance>
                        </form>
                    </forms>
                </config>
            </configurations>
        </module>
    </modules>
</extension> 
